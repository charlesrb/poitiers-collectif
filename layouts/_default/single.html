{{ define "main" }}

<!-- Hero moderne avec gradient -->
<section class="article-hero">
    <div class="hero-container">
        <div class="breadcrumb">
            <a href="{{ "/" | relURL }}">Accueil</a>
            <span class="breadcrumb-separator">‚Üí</span>
            <a href="{{ "/posts" | relURL }}">Actualit√©s</a>
            <span class="breadcrumb-separator">‚Üí</span>
            <span>{{ .Title }}</span>
        </div>
        
        <div class="article-meta-modern">
            <div class="meta-item">
                <span>üìÖ</span>
                {{ if hugo.IsServer }}
                <span data-tina-field="date">{{ .Date.Format "2 janvier 2006" }}</span>
                {{ else }}
                <span>{{ .Date.Format "2 janvier 2006" }}</span>
                {{ end }}
            </div>
            {{ if .Params.categories }}
                {{ range .Params.categories }}
                <div class="meta-item">
                    <span>üè∑Ô∏è</span>
                    {{ if hugo.IsServer }}
                    <span data-tina-field="categories">{{ . }}</span>
                    {{ else }}
                    <span>{{ . }}</span>
                    {{ end }}
                </div>
                {{ end }}
            {{ end }}
            <div class="meta-item">
                <span>‚è±Ô∏è</span>
                <span>{{ math.Round (div (countwords .Content) 200.0) }} min de lecture</span>
            </div>
            {{ if .Params.author }}
            <div class="meta-item">
                <span>‚úçÔ∏è</span>
                {{ if hugo.IsServer }}
                <span data-tina-field="author">{{ .Params.author }}</span>
                {{ else }}
                <span>{{ .Params.author }}</span>
                {{ end }}
            </div>
            {{ end }}
        </div>
        
        {{ if hugo.IsServer }}
        <h1 class="article-title-modern" data-tina-field="title">{{ .Title }}</h1>
        {{ else }}
        <h1 class="article-title-modern">{{ .Title }}</h1>
        {{ end }}
        
        {{ if .Summary }}
        <p class="article-excerpt-modern">{{ .Summary }}</p>
        {{ end }}
    </div>
</section>

<!-- Contenu moderne -->
<div class="content-wrapper">
    <article class="article-content-modern">
        <div class="content-inner">
            {{ if hugo.IsServer }}
            <div data-tina-field="body">{{ .Content }}</div>
            {{ else }}
            {{ .Content }}
            {{ end }}
            
            <!-- Tags -->
            {{ if .Params.tags }}
            <div class="tags-container">
                {{ range .Params.tags }}
                {{ if hugo.IsServer }}
                <span class="tag-modern" data-tina-field="tags">{{ . }}</span>
                {{ else }}
                <span class="tag-modern">{{ . }}</span>
                {{ end }}
                {{ end }}
            </div>
            {{ end }}
            
            <!-- Call to action -->
            <div class="cta-card">
                <h3>üó£Ô∏è Participez √† la co-construction !</h3>
                <p>Rejoignez-nous pour enrichir ces propositions et construire ensemble l'avenir de Poitiers.</p>
                <a href="{{ "/participer" | relURL }}" class="btn-modern">
                    <span>Je m'implique</span>
                    <span>‚Üí</span>
                </a>
            </div>
        </div>
    </article>

    <!-- Sidebar moderne -->
    <aside class="sidebar-modern">
        <!-- Articles li√©s -->
        {{ $related := .Site.RegularPages.Related . | first 3 }}
        {{ if $related }}
        <div class="sidebar-card">
            <div class="sidebar-card-header">
                <h3 class="sidebar-card-title">
                    <span>üì∞</span>
                    <span>Articles connexes</span>
                </h3>
            </div>
            <div class="sidebar-card-content">
                <div class="related-list">
                    {{ range $related }}
                    <div class="related-item">
                        <a href="{{ .Permalink }}" class="related-link">{{ .Title }}</a>
                        <div class="related-date">{{ .Date.Format "2 janvier 2006" }}</div>
                    </div>
                    {{ end }}
                </div>
            </div>
        </div>
        {{ end }}

        <!-- Articles r√©cents -->
        <div class="sidebar-card">
            <div class="sidebar-card-header">
                <h3 class="sidebar-card-title">
                    <span>üì∞</span>
                    <span>Articles r√©cents</span>
                </h3>
            </div>
            <div class="sidebar-card-content">
                <div class="related-list">
                    {{ range first 5 (where .Site.RegularPages "Type" "posts") }}
                    <div class="related-item">
                        <a href="{{ .Permalink }}" class="related-link">{{ .Title }}</a>
                        <div class="related-date">{{ .Date.Format "2 janvier 2006" }}</div>
                    </div>
                    {{ end }}
                </div>
            </div>
        </div>

        <!-- √âv√©nements √† venir -->
        {{ $events := where .Site.RegularPages "Type" "events" }}
        {{ if $events }}
        <div class="sidebar-card">
            <div class="sidebar-card-header">
                <h3 class="sidebar-card-title">
                    <span>üìÖ</span>
                    <span>Prochains rendez-vous</span>
                </h3>
            </div>
            <div class="sidebar-card-content">
                {{ range first 3 $events }}
                <div class="event-card-modern">
                    <div class="event-date-modern">{{ .Date.Format "2 JAN ‚Ä¢ 15H04" }}</div>
                    <div class="event-title-modern">{{ .Title }}</div>
                    {{ if .Params.location }}
                    <div class="event-location">üìç {{ .Params.location }}</div>
                    {{ end }}
                </div>
                {{ end }}
            </div>
        </div>
        {{ end }}

        <!-- Call to action participatif -->
        <div class="sidebar-card">
            <div class="sidebar-card-header">
                <h3 class="sidebar-card-title">
                    <span>üéØ</span>
                    <span>Agir ensemble</span>
                </h3>
            </div>
            <div class="sidebar-card-content">
                <p style="color: var(--text-secondary); font-size: var(--font-size-sm); line-height: 1.6; margin-bottom: 1rem;">
                    Vous avez des id√©es pour am√©liorer Poitiers ? Votre expertise du terrain nous int√©resse !
                </p>
                <a href="{{ "/participer" | relURL }}" class="btn-modern" style="width: 100%; justify-content: center;">
                    <span>Nous rejoindre</span>
                    <span>‚ú®</span>
                </a>
            </div>
        </div>

        <!-- Newsletter -->
        <div class="sidebar-card">
            <div class="sidebar-card-header">
                <h3 class="sidebar-card-title">
                    <span>üì¨</span>
                    <span>Restez inform√©</span>
                </h3>
            </div>
            <div class="sidebar-card-content">
                <p style="color: var(--text-secondary); font-size: var(--font-size-sm); line-height: 1.6; margin-bottom: 1rem;">
                    Recevez nos actualit√©s et les invitations aux √©v√©nements.
                </p>
                <form style="display: flex; flex-direction: column; gap: 0.75rem;" action="#" method="post">
                    <input 
                        type="email" 
                        name="email"
                        placeholder="votre@email.fr" 
                        required
                        style="padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); font-size: var(--font-size-sm); outline: none; transition: border-color 0.2s;"
                    >
                    <button type="submit" class="btn-modern" style="width: 100%; justify-content: center;">
                        <span>S'abonner</span>
                        <span>üì®</span>
                    </button>
                </form>
            </div>
        </div>
    </aside>
</div>

<!-- Navigation entre articles -->
<div class="article-nav-modern">
    {{ if .PrevInSection }}
    <a href="{{ .PrevInSection.Permalink }}" class="nav-card nav-prev">
        <span class="nav-direction">‚Üê Article pr√©c√©dent</span>
        <h4 class="nav-title">{{ .PrevInSection.Title }}</h4>
    </a>
    {{ end }}
    
    {{ if .NextInSection }}
    <a href="{{ .NextInSection.Permalink }}" class="nav-card nav-next">
        <span class="nav-direction">Article suivant ‚Üí</span>
        <h4 class="nav-title">{{ .NextInSection.Title }}</h4>
    </a>
    {{ end }}
</div>

{{ end }}